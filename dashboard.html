<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Daily Expense Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>

    <style>
        * {
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(-45deg, #0f2027, #203a43, #2c5364, #000);
            color: rgba(0, 242, 255, 0.904);
            padding: 10px;
        }

        /* üî• Card fade */
        .card {
            width: 100%;
            max-width: 820px;
            background: rgba(53, 165, 230, 0.326);
            backdrop-filter: blur(12px);
            padding: 15px;
            border-radius: 14px;
            text-align: center;
            animation: cardIn .7s ease;
        }

        @keyframes cardIn {
            from {
                opacity: 0;
                transform: scale(.95) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        h2 {
            margin-top: 5px;
            font-weight: bold;
        }

        input,
        select,
        button {
            width: 100%;
            padding: 12px;
            margin: 6px 0;
            border: none;
            border-radius: 8px;
            font-size: 15px;
        }

        /* üî• Input glow */
        input,
        select {
            background: #222;
            color: white;
            transition: .3s;
        }

        input:focus,
        select:focus {
            outline: none;
            box-shadow: 0 0 12px cyan;
            transform: scale(1.02);
        }

        /* üî• Button micro */
        button {
            background: #00ddffb1;
            font-weight: bold;
            cursor: pointer;
            transition: .25s;
        }

        button:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 0 12px cyan;
        }

        button:active {
            transform: scale(.95);
        }

        .row {
            display: flex;
            gap: 6px;
        }

        /* üé§ Mic pulse */
        .mic {
            width: 55px;
            background: rgba(0, 255, 221, 0.712);
            font-size: 18px;
            animation: micPulse 1.8s infinite;
        }

        @keyframes micPulse {
            0% {
                box-shadow: 0 0 0 rgba(0, 255, 255, .4);
            }

            70% {
                box-shadow: 0 0 18px rgba(0, 255, 255, .9);
            }

            100% {
                box-shadow: 0 0 0 rgba(0, 255, 255, .4);
            }
        }

        .table-box {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            margin-top: 10px;
        }

        td,
        th {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 6px;
            font-size: 14px;
            text-align: center;
        }

        /* üî• Row hover */
        tbody tr {
            transition: .3s;
        }

        tbody tr:hover {
            background: rgba(0, 255, 255, .08);
            transform: scale(1.01);
        }

        /* üî• Row entry animation */
        tbody tr {
            animation: rowIn .4s ease;
        }

        @keyframes rowIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* üî• Image hover zoom */
        img {
            width: 40px;
            cursor: pointer;
            border-radius: 5px;
            transition: .3s;
        }

        img:hover {
            transform: scale(1.4);
        }

        /* üî• Total glow */
        #total {
            margin: 10px 0;
            font-weight: bold;
            font-size: 18px;
            animation: totalGlow 2s infinite alternate;
        }

        @keyframes totalGlow {
            from {
                text-shadow: 0 0 5px cyan;
            }

            to {
                text-shadow: 0 0 20px cyan;
            }
        }

        /* üî• Action buttons wiggle */
        td button:hover {
            animation: wiggle .3s;
        }

        @keyframes wiggle {
            0% {
                transform: rotate(0);
            }

            25% {
                transform: rotate(-5deg);
            }

            50% {
                transform: rotate(5deg);
            }

            75% {
                transform: rotate(-3deg);
            }

            100% {
                transform: rotate(0);
            }
        }

        footer {
            text-align: center;
            padding: 10px;
            color: #aaa;
        }
        /* üî• Soft floating card */
.card{
    animation: cardIn .7s ease, floatCard 6s ease-in-out infinite;
}

@keyframes floatCard{
    0%{ transform: translateY(0px); }
    50%{ transform: translateY(-8px); }
    100%{ transform: translateY(0px); }
}
    </style>
</head>

<body>

    <div class="card">

        <h2><b>Daily Expense Tracker</b></h2>

        <div class="row">
            <input id="title" placeholder="Expense Title">
            <button class="mic" onclick="voice()">üé§</button>
        </div>

        <input id="amount" type="number" placeholder="Amount">
        <input id="date" type="date">

        <select id="category">
            <option value="">-- Select Category --</option>
            <option>üçî Food</option>
            <option>üöï Transport</option>
            <option>üè† Rent</option>
            <option>üí° Electricity / Water</option>
            <option>üì± Mobile / Internet</option>
            <option>üõí Groceries</option>
            <option>üè• Medical</option>
            <option>üéì Education</option>
            <option>üéâ Entertainment</option>
            <option>üõç Shopping</option>
            <option>‚ùì Others</option>
        </select>

        <input id="bill" type="file" accept="image/*">
        <button onclick="startScan()">üì∑ Scan QR / Bar Code</button>

        <div id="scanner" style="width:300px; margin:auto; display:none;"></div>

        <button onclick="add()">Add / Update Expense</button>

        <h3 id="total">Total : ‚Çπ0</h3>

        <button onclick="downloadReport()">‚¨áÔ∏è Download Report Page</button>

        <div class="table-box">
            <table>
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Amount</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Bill</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="list"></tbody>
            </table>
        </div>

        <button onclick="logout()">Logout</button>

        <footer>¬© 2026 Daily Expense Tracker | Designed by GKY</footer>

    </div>

    <script>
        if (sessionStorage.getItem("loggedIn") !== "true") location.href = "login.html";

        let arr = JSON.parse(localStorage.getItem("exp")) || [];
        let editId = -1;

        function add() {
            if (!title.value || !amount.value || !date.value || !category.value) {
                alert("Please fill all fields");
                return;
            }

            if (bill.files[0]) {
                let r = new FileReader();
                r.onload = () => save(r.result);
                r.readAsDataURL(bill.files[0]);
            } else save("");

            function save(pic) {
                let obj = { t: title.value, a: +amount.value, c: category.value, d: date.value, b: pic };

                if (editId === -1) arr.push(obj);
                else { arr[editId] = obj; editId = -1; }

                localStorage.setItem("exp", JSON.stringify(arr));
                clear(); render();
            }
        }

        function render() {
            list.innerHTML = "";
            let tot = 0;

            arr.forEach((e, i) => {
                tot += e.a;
                list.innerHTML += `
<tr>
<td>${e.t}</td>
<td>‚Çπ${e.a}</td>
<td>${e.c}</td>
<td>${e.d}</td>
<td>${e.b ? `<img src="${e.b}" onclick="view('${e.b}')">` : "-"}</td>
<td>
<button onclick="edit(${i})">‚úèÔ∏è</button>
<button onclick="del(${i})">üóëÔ∏è</button>
</td>
</tr>`;
            });

            total.innerText = "Total : ‚Çπ" + tot;
        }

        function del(i) {
            if (confirm("Delete this expense?")) {
                arr.splice(i, 1);
                localStorage.setItem("exp", JSON.stringify(arr));
                render();
            }
        }

        function edit(i) {
            let e = arr[i];
            title.value = e.t;
            amount.value = e.a;
            category.value = e.c;
            date.value = e.d;
            editId = i;
        }

        function view(src) {
            let w = window.open();
            w.document.write(`<img src="${src}" style="width:100%">`);
        }

        function clear() {
            title.value = "";
            amount.value = "";
            date.value = "";
            category.value = "";
            bill.value = "";
        }

        function logout() {
            sessionStorage.clear();
            location.href = "login.html";
        }

        function voice() {
            let r = new webkitSpeechRecognition();
            r.lang = "en-IN";
            r.onresult = e => title.value = e.results[0][0].transcript;
            r.start();
        }

        /* ‚úÖ REPORT PAGE OPEN FUNCTION */
        function downloadReport() {
            window.open("report.html", "_blank");
        }

        render();
        let qr;

function startScan() {
    document.getElementById("scanner").style.display = "block";

    qr = new Html5Qrcode("scanner");

    qr.start(
        { facingMode: "environment" },
        {
            fps: 10,
            qrbox: 250,
            formatsToSupport: [
                Html5QrcodeSupportedFormats.QR_CODE,
                Html5QrcodeSupportedFormats.CODE_128,
                Html5QrcodeSupportedFormats.CODE_39,
                Html5QrcodeSupportedFormats.EAN_13,
                Html5QrcodeSupportedFormats.EAN_8,
                Html5QrcodeSupportedFormats.UPC_A,
                Html5QrcodeSupportedFormats.UPC_E
            ]
        },
        scanSuccess,
        scanError
    );
}

function scanSuccess(decodedText) {
    console.log("Scanned:", decodedText);

    /* 
      Expected QR / Barcode format example:
      Milk,120,2026-01-22,üçî Food
    */

    let data = decodedText.split(",");

    if (data.length >= 4) {
        title.value = data[0].trim();
        amount.value = data[1].trim();
        date.value = data[2].trim();
        category.value = data[3].trim();
    } else {
        alert("Invalid QR / Barcode format!");
    }

    qr.stop();
    document.getElementById("scanner").style.display = "none";
}

function scanError(err) {
    // silent ignore
}

    </script>

</body>

</html>
